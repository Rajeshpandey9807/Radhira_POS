@model PosApp.Web.Features.BusinessProfiles.BusinessProfileFormViewModel
@{
    ViewData["Title"] = "Business profile";
}

@section Styles {
    <link rel="stylesheet" href="~/css/business-profile.css" asp-append-version="true" />
}

<section class="users-header">
    <div class="bp-shell">
        <p class="eyebrow">Business setup</p>
        <h2>Add Business Details</h2>
        <div class="bp-note">
            <strong>Note:</strong> Details added below will be shown on your Invoices
        </div>
    </div>
</section>

<form asp-action="Index" method="post" enctype="multipart/form-data" class="card-form">
    <partial name="_Form" model="Model" />
    <div class="form-actions">
        <button class="btn primary" type="submit">Save business profile</button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            function wireImagePreview(inputId, imgId, placeholderId) {
                var input = document.getElementById(inputId);
                var img = document.getElementById(imgId);
                var placeholder = document.getElementById(placeholderId);
                if (!input || !img) return;

                input.addEventListener("change", function () {
                    var file = input.files && input.files[0];
                    if (!file) {
                        img.style.display = "none";
                        img.removeAttribute("src");
                        if (placeholder) placeholder.style.display = "block";
                        return;
                    }

                    if (!file.type || !file.type.startsWith("image/")) {
                        img.style.display = "none";
                        img.removeAttribute("src");
                        if (placeholder) placeholder.style.display = "block";
                        return;
                    }

                    var url = URL.createObjectURL(file);
                    img.onload = function () { URL.revokeObjectURL(url); };
                    img.src = url;
                    img.style.display = "block";
                    if (placeholder) placeholder.style.display = "none";
                });
            }

            function syncGstNumberVisibility() {
                var gstSelect = document.getElementById("IsGstRegistered");
                var gstGroup = document.getElementById("gstNumberGroup");
                var gstInput = document.getElementById("GstNumber");
                if (!gstSelect || !gstGroup || !gstInput) return;

                var isYes = gstSelect.value === "true";
                gstGroup.classList.toggle("bp-hidden", !isYes);
                if (isYes) {
                    gstInput.setAttribute("required", "required");
                } else {
                    gstInput.removeAttribute("required");
                    gstInput.value = "";
                }
            }

            wireImagePreview("BusinessLogoFile", "BusinessLogoPreview", "BusinessLogoPlaceholder");
            wireImagePreview("SignatureFile", "SignaturePreview", "SignaturePlaceholder");

            var gstSelect = document.getElementById("IsGstRegistered");
            if (gstSelect) {
                gstSelect.addEventListener("change", syncGstNumberVisibility);
            }
            syncGstNumberVisibility();
        })();
    </script>
}

